<!DOCTYPE html>

<html>

<head>
	<title>Play Game</title>
	<link rel="stylesheet" href="/style/style.css" >
</head>

<body> 
	<div id="gameSession">
		<p id="gameSession"></p>
	</div>
	<div id="playerList">
	</div>

</body>
<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script type="text/javascript">
	var players = {};

	window.onload = function() {
		var socket = io();
		var data = {
			playerCount: sessionStorage.getItem("playerCount"),
			playerName: sessionStorage.getItem("playerName"),
			sessionID: sessionStorage.getItem("sessionID"),
			host: sessionStorage.getItem("host"),
			socketID: null,
			createGame: sessionStorage.getItem("createGame")
		};
	
		console.log(data);
		if(data.host == "true" && data.createGame == "true") {
			socket.emit('create-game', data);
			console.log('Attempting to create the game...');
			sessionStorage.setItem("createGame", false);
		}
		else {
			socket.emit('join-game', data);
		}
	
		socket.on("connection-response", function(res) {
			console.log("The game has been successfully created!");
		});
	
		socket.on('get-all-players', function(playerNames, playerSockets) {
			console.log(playerNames);
			
			for(var i = 0; i < playerNames.length; i++) {
				if(document.getElementById(playerSockets[i]) == null ) {
					var div = document.createElement("div");
					var text = document.createElement("p");
					var node = document.createTextNode(playerNames[i]);
					text.appendChild(node);
					div.appendChild(text);
					document.getElementById("playerList").appendChild(div);
					div.className = "player";
					div.id = playerSockets[i];
				}
			}
		});
	
		socket.on('new-player', function(name, sock) {
			console.log(name + " has joined the game!");
			if(document.getElementById(sock) == null ) {
				var div = document.createElement("div");
				var text = document.createElement("p");
				var node = document.createTextNode(name);
				text.appendChild(node);
				div.appendChild(text);
				document.getElementById("playerList").appendChild(div);
				div.className = "player";
				div.ids = sock;
			}
		});
		
		socket.on('store-session', function(sess, sock) {
			sessionStorage.setItem("sessionID", sess);
			sessionStorage.setItem("socketID", sock);
			console.log("Store sessions: " + sess);
			document.getElementById("gameSession").innerHTML = sessionStorage.getItem("sessionID");
		});
		
		socket.on('player-left', function(sock) {
			var parent = document.getElementById("playerList");
			var playerDiv = document.getElementById(sock);
			parent.removeChild(playerDiv);
		});
		
	};
	
</script>
</html>